#!/usr/bin/env php
<?php

$rootDir = realpath(__DIR__.'/../');
$databaseDir = $rootDir.'/cache';

array_shift($argv);
if (!isset($argv[0])) {
    exit(<<<EOF
SQLite Database script management.

Specify a command to run:

install <driver>: initialize database
load-fixtures <driver> <file>: load fixtures

EOF
    );
}

if (!in_array($command = array_shift($argv), array('install', 'load-fixtures'))) {
    exit(sprintf("Command \"%s\" does not exist.\n", $command));
}

if (!is_dir($databaseDir)) {
    mkdir($databaseDir, 0777, true);
}

$driver = $argv[0];

if ($command == 'install')
{
	switch ($driver)
	{
		case 'sqlite':
			$db = new SQLite3($databaseDir.'/asktea.db');
			$db->exec(file_get_contents($rootDir.'/data/sql/schema.sqlite3.sql'));
			break;
		default:
			exit(sprintf("Driver \"%s\" not supported.\n", $driver));
	}
}
elseif ($command == 'load-fixtures')
{
	$file = $argv[1];

	switch ($driver)
	{
		case 'sqlite':
			$db = new SQLite3($databaseDir.'/asktea.db');
			$db->exec(file_get_contents($file));
			break;
		default:
			exit(sprintf("Driver \"%s\" not supported.\n", $argv[0]));
	}
}
